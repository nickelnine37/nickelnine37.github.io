<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta charset="utf-8" content="text/html" http-equiv="Content-Type">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"/>
<title>Rap Skills Analysis: A Computational Approach part 2</title>
<meta content="True" name="HandheldFriendly"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="origin" name="referrer"/>
<meta content="Pelican" name="generator"/>
<link href="" rel="canonical"/>
<!-- Feed -->
<link href="/theme/css/style.css" rel="stylesheet" type="text/css"/>
<!-- Code highlight color scheme -->
<link href="/theme/css/code_blocks/c3.css" rel="stylesheet"/>
<!-- CSS specified by the user -->
<link href="//home/ed/Documents/Code/PA2/attila/static/css/my_colors.css" rel="stylesheet" type="text/css">
<!-- Custom fonts -->
<link href="https://fonts.googleapis.com/css?family=Montserrat:400,300" rel="stylesheet" type="text/css"/>
<link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css"/>
<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
<link href="/rap-part-two.html" rel="canonical"/>
<meta content="The second entry in a series on some data analysis into rap lyrics." name="description"/>
<meta content="Edward Antonian" name="author"/>
<meta content="data science" name="tags"/>
<meta content="python" name="tags"/>
<meta content="natural language processing" name="tags"/>
<meta content="rap" name="tags"/>
<meta content="hip hop" name="tags"/>
<meta content="" property="og:locale">
<meta content="But is it Data Science?" property="og:site_name">
<meta content="website" property="og:type">
<meta content="But is it Data Science?" property="og:title">
<meta content="View the blog." property="og:description">
<meta content="" property="og:url">
<meta content="/static/images/contact-bg.jpg" property="og:image">
<meta content="https://facebook.com/myprofile" property="article:publisher"/>
<meta content="article" property="og:type"/>
<meta content="/author/edward-antonian.html" property="article:author"/>
<meta content="/rap-part-two.html" property="og:url"/>
<meta content="Rap Skills Analysis: A Computational Approach part 2" property="og:title"/>
<meta content="2017-10-20 00:00:00+01:00" property="article:published_time"/>
<meta content="The second entry in a series on some data analysis into rap lyrics." property="og:description"/>
<meta content="/static/images/contact-bg.jpg" property="og:image"/>
<meta content="summary_large_image" name="twitter:card"/>
<meta content="@myprofile" name="twitter:site"/>
<meta content="Rap Skills Analysis: A Computational Approach part 2" name="twitter:title"/>
<meta content="/rap-part-two.html" name="twitter:url"/>
<meta content="/static/images/contact-bg.jpg" name="twitter:image:src"/>
<meta content="The second entry in a series on some data analysis into rap lyrics." name="twitter:description"/>
</meta></meta></meta></meta></meta></meta></meta></link></meta></head>
<!-- TODO : Body class -->
<body class="home-template">
<nav id="menu">
<a class="close-button">Close</a>
<div class="nav-wrapper">
<p class="nav-label">Menu</p>
<ul><li role="presentation"><a href="pages/about.html">About</a></li><li role="presentation"><a href="archives.html">Archive</a></li>
</ul>
</div>
</nav>
<!-- Progressbar -->
<div class="progress-container">
<span class="progress-bar"></span>
</div>
<!-- Page Header -->
<!-- Set your background image for this header on the line below. -->
<header class="has-cover" id="post-header">
<div class="inner">
<nav id="navigation">
<span class="nav-button" id="home-button">
<a class="home-button" href="index.html" title="Home"><i class="ic ic-arrow-left"></i> Home</a>
</span>
<span class="nav-button" id="menu-button">
<a class="menu-button"><i class="ic ic-menu"></i> Menu</a>
</span>
</nav>
<h1 class="post-title">Rap Skills Analysis: A Computational Approach part 2</h1>
<!-- TODO : Proper class for headline -->
<span class="post-meta">
<a href="/author/edward-antonian.html">Edward antonian</a>
            | <time datetime="Fri 20 October 2017">Fri 20 October 2017</time>
</span>
<!-- TODO : Modified check -->
<span class="post-meta"> | Updated on Mon 18 December 2017</span>
<div class="post-cover cover" style="background-image: url('static/images/contact-bg.jpg')">
</div>
</div></header>
<section id="wrapper">
<a class="hidden-close"></a>
<!-- Post content -->
<main class="content" role="main">
<article class="post">
<div class="inner">
<section class="post-content">
<h1>Part 2: Analysing Lyrics</h1>
<p>As a recap, the two metrics I'm going to target are verbosity and rhyme density, i.e. the fraction of the 20,000 words that are unique, and the fraction which rhyme with each other. The first part is MUCH simpler than the second as we shall see. </p>
<h2>2.1 Unique Words</h2>
<p>We can do a basic word count pretty easily. The only complication comes from deciding what counts as a word. While this might sound easy, there's actually a significant amount of difficulty that arises from this. As a simple example, are words joined by a hyphen one or two words? The headache can be avoided entirely by using a third party word tokeniser (an algorithm that splits text into words). The most renowned python module out there for this kind of analysis is the Natural Language Tool-Kit (NLTK) package. Note that to use their tokeniser you will have to download some additional things on top of the pip install (see website for documentation). For now, I'm just going to use it in the code. </p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nltk.tokenize</span> <span class="kn">import</span> <span class="n">word_tokenize</span>

<span class="n">punc</span> <span class="o">=</span> <span class="p">[</span><span class="s1">','</span><span class="p">,</span><span class="s1">'.'</span><span class="p">,</span> <span class="s1">'/'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\'</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\"</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'</span><span class="se">\\</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'$'</span><span class="p">,</span> <span class="s1">';'</span><span class="p">,</span> <span class="s1">':'</span><span class="p">,</span> <span class="s1">'!'</span><span class="p">,</span> <span class="s1">'?'</span><span class="p">,</span> <span class="s1">'-'</span><span class="p">,</span>  <span class="s1">'#'</span><span class="p">,</span> <span class="s1">'('</span><span class="p">,</span> <span class="s1">')'</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">word_freq_list</span><span class="p">(</span><span class="n">text_file</span><span class="p">):</span>
    <span class="sd">'''Take an input .txt file and perform a unique word count'''</span>
    <span class="n">thefile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="n">text_file</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span>
    <span class="n">words</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">total_words</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">thefile</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">word_tokenize</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">punc</span><span class="p">:</span>
                    <span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
                    <span class="n">counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">total_words</span> <span class="o">+=</span> <span class="mi">1</span>        
            <span class="k">else</span><span class="p">:</span>
                <span class="n">counts</span><span class="p">[</span><span class="n">words</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">word</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">total_words</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">total_words</span><span class="o">&gt;=</span><span class="mi">20000</span><span class="p">:</span>
                <span class="n">dic</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">counts</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>   
                <span class="k">return</span> <span class="n">dic</span>
    <span class="k">return</span> <span class="s1">'Not enough words'</span>
</pre></div>
<p>Note that we want to exclude all punctuation and repeats of words with upper and lowercase letters. Therefore we make sure each word isn't inside the punctuation list, and use .lower(). </p>
<h2>3.2 Finding the Rhyme Density</h2>
<h3>3.2.1 Identifying Word Sounds</h3>
<p>Ok, that was simple enough! Now for the tricky part: rhyme sounds. How do we determine whether two English words rhyme? Well, that's hard. The English language is notoriously difficult with many odd spellings and unintuitive sounds. So... we're not going to worry about it. We'll just use some third party software called eSpeak. Their tool will allow us to convert words into their phonetic spelling, so we can directly compare the sound of words. </p>
<p>You can go on over to their website install and the software. It's a command line tool so make sure to add the eSpeak directory to your system path to allow command line calls. If you're running a Linux machine, a simple</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">espeak</span>
</pre></div>
<p>should do the trick. Once that's done, we can convert text into its phonetic form with the following call:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">espeak</span> <span class="o">-</span><span class="n">q</span> <span class="o">--</span><span class="n">ipa</span> <span class="o">-</span><span class="n">v</span> <span class="n">en</span><span class="o">-</span><span class="n">us</span> <span class="o">&lt;</span><span class="n">text</span><span class="o">&gt;</span> 
</pre></div>
<p>We can use the check_output() function within python to access the command line. Here's an example of call and expected output:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">check_output</span>

<span class="n">line</span> <span class="o">=</span>  <span class="s2">"I'm still not a player but you still a hater,</span><span class="se">\n</span><span class="s2">Elevator to the top hah see you later</span><span class="se">\n</span><span class="s2">"</span>
<span class="n">line_phonetic</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">([</span><span class="s2">"espeak"</span><span class="p">,</span> <span class="s2">"-q"</span><span class="p">,</span> <span class="s2">"--ipa"</span><span class="p">,</span> <span class="s2">"-v"</span><span class="p">,</span> <span class="s2">"en-us"</span><span class="p">,</span> <span class="n">line</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s1">'Original line: </span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">'Phonetic Version: </span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="n">line_phonetic</span><span class="p">)</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="n">Original</span> <span class="n">line</span><span class="p">:</span> 
 <span class="n">I</span><span class="err">'</span><span class="n">m</span> <span class="n">still</span> <span class="k">not</span> <span class="n">a</span> <span class="n">player</span> <span class="n">but</span> <span class="n">you</span> <span class="n">still</span> <span class="n">a</span> <span class="n">hater</span><span class="p">,</span>
<span class="n">Elevator</span> <span class="k">to</span> <span class="n">the</span> <span class="n">top</span> <span class="n">hah</span> <span class="n">see</span> <span class="n">you</span> <span class="n">later</span>

<span class="n">Phonetic</span> <span class="k">Version</span><span class="p">:</span> 
  <span class="n">aɪm</span> <span class="n">stˈɪl</span> <span class="n">nˌɑːɾə</span> <span class="n">plˈeɪɚ</span> <span class="n">bˌʌt</span> <span class="n">juː</span> <span class="n">stˈɪl</span> <span class="err">ɐ</span> <span class="n">hˈeɪɾɚ</span>
 <span class="err">ˈɛ</span><span class="n">lɪvˌeɪɾɚ</span> <span class="n">tə</span> <span class="err">ðə</span> <span class="n">tˈɑːp</span> <span class="n">hˈɑː</span> <span class="n">sˈiː</span> <span class="n">juː</span> <span class="n">lˈeɪɾɚ</span>
</pre></div>
<p>Since we are interested in rhyming sounds (and are going to be lenient about half-rhymes) we're really only interested in the vowel sounds. So the first thing we want to do is take our lyrics, and convert it into a list of ordered vowel sounds, stripped of their consonants. An exhaustive list of all the possible English vowel sounds is shown below.</p>
<div class="highlight"><pre><span></span><span class="n">vowels_sounds</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'aɪ'</span><span class="p">,</span><span class="s1">'aʊ'</span><span class="p">,</span><span class="s1">'eɪ'</span><span class="p">,</span><span class="s1">'i'</span><span class="p">,</span><span class="s1">'oʊ'</span><span class="p">,</span><span class="s1">'oː'</span><span class="p">,</span><span class="s1">'uː'</span><span class="p">,</span><span class="s1">'æ'</span><span class="p">,</span> <span class="s1">'ɑː'</span><span class="p">,</span>
                 <span class="s1">'ɔ'</span><span class="p">,</span><span class="s1">'ɔɪ'</span><span class="p">,</span><span class="s1">'ɔː'</span><span class="p">,</span><span class="s1">'ɛ'</span><span class="p">,</span><span class="s1">'ɛ'</span><span class="p">,</span><span class="s1">'ɜː'</span><span class="p">,</span><span class="s1">'ɪ'</span><span class="p">,</span><span class="s1">'ʊ'</span><span class="p">,</span><span class="s1">'ʌ'</span><span class="p">,</span> <span class="s1">'ɚ'</span><span class="p">,</span> <span class="s1">'ə'</span><span class="p">]</span>
</pre></div>
<p>Notice that some are two characters long, and sometimes the first character of a two-character vowel sound also exists as its own separate vowel sound. Therefore we can split this into two lists: possible first characters and possible second characters</p>
<div class="highlight"><pre><span></span><span class="n">first</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'a'</span><span class="p">,</span><span class="s1">'e'</span><span class="p">,</span><span class="s1">'i'</span><span class="p">,</span><span class="s1">'o'</span><span class="p">,</span><span class="s1">'u'</span><span class="p">,</span><span class="s1">'ɐ'</span><span class="p">,</span><span class="s1">'æ'</span><span class="p">,</span><span class="s1">'ɑ'</span><span class="p">,</span><span class="s1">'ɒ'</span><span class="p">,</span>
         <span class="s1">'ɔ'</span><span class="p">,</span><span class="s1">'ɛ'</span><span class="p">,</span><span class="s1">'ɜ'</span><span class="p">,</span><span class="s1">'ɪ'</span><span class="p">,</span><span class="s1">'ʊ'</span><span class="p">,</span><span class="s1">'ʌ'</span><span class="p">,</span><span class="s1">'ɚ'</span><span class="p">,</span> <span class="s1">'ə'</span><span class="p">]</span>
<span class="n">second</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'ɪ'</span><span class="p">,</span><span class="s1">'ʊ'</span><span class="p">,</span><span class="s1">'ː'</span><span class="p">]</span>
</pre></div>
<p>We can use these two lists to extract all the vowels from a phonetic string</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">extract_vowels</span><span class="p">(</span><span class="n">phonetic_text</span><span class="p">):</span>

    <span class="n">phonetic_vowels</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">phonetic_text</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
            <span class="n">letter</span> <span class="o">=</span> <span class="n">word</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">letter</span> <span class="ow">in</span> <span class="n">first</span><span class="p">:</span>
                <span class="n">vowel</span> <span class="o">=</span> <span class="n">letter</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">letter</span> <span class="o">=</span> <span class="n">word</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">letter</span> <span class="ow">in</span> <span class="n">second</span><span class="p">:</span>
                        <span class="n">vowel</span> <span class="o">+=</span> <span class="n">letter</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">pass</span>

                <span class="n">phonetic_vowels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vowel</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">phonetic_vowels</span>

<span class="n">vowel_list</span> <span class="o">=</span> <span class="n">extract_vowels</span><span class="p">(</span><span class="n">line_phonetic</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="n">line_phonetic</span><span class="p">,</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="n">vowel_list</span><span class="p">)</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="n">I</span><span class="s1">'m still not a player but you still a hater,</span>
<span class="s1">Elevator to the top hah see you later</span>

<span class="s1">  aɪm stˈɪl nˌɑːɾə plˈeɪɚ bˌʌt juː stˈɪl ɐ hˈeɪɾɚ</span>
<span class="s1"> ˈɛlɪvˌeɪɾɚ tə ðə tˈɑːp hˈɑː sˈiː juː lˈeɪɾɚ</span>

<span class="s1"> ['</span><span class="n">aɪ</span><span class="s1">', '</span><span class="err">ɪ</span><span class="s1">', '</span><span class="err">ɑː</span><span class="s1">', '</span><span class="err">ə</span><span class="s1">', '</span><span class="n">eɪ</span><span class="s1">', '</span><span class="err">ɚ</span><span class="s1">', '</span><span class="err">ʌ</span><span class="s1">', '</span><span class="n">uː</span><span class="s1">', '</span><span class="err">ɪ</span><span class="s1">', '</span><span class="err">ɐ</span><span class="s1">', '</span><span class="n">eɪ</span><span class="s1">', '</span><span class="err">ɚ</span><span class="s1">', '</span><span class="err">ɛ</span><span class="s1">', '</span><span class="err">ɪ</span><span class="s1">', '</span><span class="n">eɪ</span><span class="s1">', '</span><span class="err">ɚ</span><span class="s1">', '</span><span class="err">ə</span><span class="s1">', '</span><span class="err">ə</span><span class="s1">', '</span><span class="err">ɑː</span><span class="s1">', '</span><span class="err">ɑː</span><span class="s1">', '</span><span class="n">iː</span><span class="s1">', '</span><span class="n">uː</span><span class="s1">', '</span><span class="n">eɪ</span><span class="s1">', '</span><span class="err">ɚ'</span><span class="p">]</span>
</pre></div>
<p>We now want a function to go through our lyrics and output a vowel list. However, this function allows only a limited number of characters to be sent to the command line. Thus, the text file has to be split up into chunks. My function is as below</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">find_phonetic_vowels</span><span class="p">(</span><span class="n">text_file</span><span class="p">):</span>
    <span class="sd">'''Strip the text of constanants and output vowell list'''</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="n">text_file</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">text_file</span><span class="p">:</span>
        <span class="n">original_text</span><span class="o">=</span><span class="n">text_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="s1">' '</span><span class="p">)</span>

    <span class="n">n</span> <span class="o">=</span> <span class="mi">30000</span> <span class="c1">#we're limited to about 30,000 characters so have to do it in chunks</span>
    <span class="n">original_text</span> <span class="o">=</span> <span class="p">[</span><span class="n">original_text</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">original_text</span><span class="p">),</span> <span class="n">n</span><span class="p">)]</span>
    <span class="n">phonetic_text</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">original_text</span><span class="p">:</span>
        <span class="n">phonetic_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">check_output</span><span class="p">([</span><span class="s2">"espeak"</span><span class="p">,</span> <span class="s2">"-q"</span><span class="p">,</span> <span class="s2">"--ipa"</span><span class="p">,</span> <span class="s2">"-v"</span><span class="p">,</span> <span class="s2">"en-us"</span><span class="p">,</span> <span class="n">chunk</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">extract_vowels</span><span class="p">(</span><span class="n">phonetic_text</span><span class="p">)</span>
</pre></div>
<h3>2.3.2 Sorting out Rhymes</h3>
<p>Ok. So for every rapper we now have a huge long list of every vowel sound they use in their first 20,000 words. How can we analyse this in order to say something useful about how densely they are rhyming? Some things to note might be</p>
<ol>
<li><strong>Repeated words aren't really rhymes.</strong> Well, we've tried pretty hard to get rid of repeated <em>lines</em> but in the format I have so far, we've now lost all information about what original words were linked to each vowel sound. This is a bit of a flaw really. If 2 Chainz just shouts 'Money Bitch, Money Bitch!' we won't really have any way of knowing that that's not actually a neat little double rhyme. Sorry... improvements to suggest?</li>
<li><strong>Multi rhymes sound better than single rhymes.</strong> 'Multis' as they are knows, and words or phrases that stretch over several syllables, maintaining an identical rhyming pattern. Whatever system we design it should reward lyrics that include long stretches of perfect rhymes</li>
<li><strong>When do you cut-off?</strong> Clearly two words separated by 20 lines that happen to rhyme do so by mere chance. How far back should we allow two vowel sounds to be linked?</li>
</ol>
<p>The process that I have designed goes like this: </p>
<ol>
<li>In-take a new vowel sound. </li>
<li>Search back through the 30 previous vowel sounds to see if there is a match. If there is no match, move to the next vowel sound.</li>
<li>If there is a match, look at the next vowel sound in the list and find out if the combination of these <em>two</em> vowel sounds appear anywhere in the 30 previous vowel sounds. If they do, add the next vowel and repeat. If they don't simply add the vowel(s) without this extension and continue. </li>
<li>When no more vowels are left, return a list of lists, containing all the vowels and vowel sequences that have been determined to rhyme.</li>
</ol>
<p>Note that part of this process involves searching for a sub-list within a list. There's no in-built python function for this as far as I could tell, so I had to write my own. It is shown below.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">is_it_in</span><span class="p">(</span><span class="n">sub_list</span><span class="p">,</span> <span class="n">main_list</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">main_list</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">main_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">sub_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">main_list</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">sub_list</span><span class="p">)]</span> <span class="o">==</span> <span class="n">sub_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span>
</pre></div>
<p>To put the above algorithm into python was a bit of a headache for me. The function I finally came up with is shown below</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">find_rhymes</span><span class="p">(</span><span class="n">phonetic_vowels</span><span class="p">,</span> <span class="n">trail</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>

    <span class="n">phonetic_vowels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">rhymes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">total_vowels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phonetic_vowels</span><span class="p">)</span>

    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">total_vowels</span><span class="p">:</span>

        <span class="n">vowel</span> <span class="o">=</span> <span class="n">phonetic_vowels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">vowel_trail</span> <span class="o">=</span> <span class="n">phonetic_vowels</span><span class="p">[:</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="n">trail</span><span class="p">:]</span>
        <span class="n">vowels</span> <span class="o">=</span> <span class="p">[</span><span class="n">vowel</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">vowel</span> <span class="ow">in</span> <span class="n">vowel_trail</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">total_vowels</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">vowel</span> <span class="o">=</span> <span class="n">phonetic_vowels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">vowels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vowel</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">is_it_in</span><span class="p">(</span><span class="n">vowels</span><span class="p">,</span> <span class="n">vowel_trail</span><span class="p">):</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">total_vowels</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">vowel</span> <span class="o">=</span> <span class="n">phonetic_vowels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">vowels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vowel</span><span class="p">)</span>
            <span class="n">rhymes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vowels</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">rhymes</span>
</pre></div>
<p>If we run this function on the same line as before, we get</p>
<div class="highlight"><pre><span></span><span class="n">rhymes</span> <span class="o">=</span> <span class="n">find_rhymes</span><span class="p">(</span><span class="n">vowel_list</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">rhymes</span><span class="p">)</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="p">[[</span><span class="s1">'ɪ'</span><span class="p">],</span> <span class="p">[</span><span class="s1">'eɪ'</span><span class="p">,</span> <span class="s1">'ɚ'</span><span class="p">],</span> <span class="p">[</span><span class="s1">'ɪ'</span><span class="p">],</span> <span class="p">[</span><span class="s1">'eɪ'</span><span class="p">,</span> <span class="s1">'ɚ'</span><span class="p">],</span> <span class="p">[</span><span class="s1">'ə'</span><span class="p">],</span> <span class="p">[</span><span class="s1">'ə'</span><span class="p">],</span> <span class="p">[</span><span class="s1">'ɑː'</span><span class="p">],</span> <span class="p">[</span><span class="s1">'ɑː'</span><span class="p">],</span> <span class="p">[</span><span class="s1">'uː'</span><span class="p">],</span> <span class="p">[</span><span class="s1">'eɪ'</span><span class="p">,</span> <span class="s1">'ɚ'</span><span class="p">]]</span>
</pre></div>
<p>Finally, I want some function to designate points based on this output list of lists of rhyme sounds. The function that I decided on allocates more points to longer multis quadratically by </p>
<div class="math">$$ f(\text{length}) = \text{length} \times (1 + \frac{\text{length} - 1}{10} \, ) $$</div>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">points</span><span class="p">(</span><span class="n">rhymes</span><span class="p">):</span>
    <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">rhyme</span> <span class="ow">in</span> <span class="n">rhymes</span><span class="p">:</span>
        <span class="n">multi</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rhyme</span><span class="p">)</span>
        <span class="n">score</span> <span class="o">+=</span> <span class="n">multi</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">multi</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">score</span>

<span class="k">print</span><span class="p">(</span><span class="n">points</span><span class="p">(</span><span class="n">rhymes</span><span class="p">))</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="mi">13</span><span class="p">.</span><span class="mi">600000000000001</span>
</pre></div>
<p>And there we have it. The final step is simply to loop over all the saved text files and save the scores to a pandas dataframe. See my next post for the results!</p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js','color.js','mhchem.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'red ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
</section>
<section class="post-info">
<div class="post-share">
<a class="twitter" href="https://twitter.com/share?text=Rap Skills Analysis: A Computational Approach part 2&amp;url=/rap-part-two.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
<i class="ic ic-twitter"></i><span class="hidden">Twitter</span>
</a>
<a class="facebook" href="https://www.facebook.com/sharer/sharer.php?u=/rap-part-two.html" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
<i class="ic ic-facebook"></i><span class="hidden">Facebook</span>
</a>
<a class="googleplus" href="https://plus.google.com/share?url=/rap-part-two.html" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
<i class="ic ic-googleplus"></i><span class="hidden">Google+</span>
</a>
<div class="clear"></div>
</div>
<aside class="post-tags">
<a href="/tag/data-science.html">data science</a><a href="/tag/python.html">python</a><a href="/tag/natural-language-processing.html">natural language processing</a><a href="/tag/rap.html">rap</a><a href="/tag/hip-hop.html">hip hop</a> </aside>
<div class="clear"></div>
</section>
<aside class="post-nav">
<div class="clear"></div>
</aside>
</div>
</article>
</main>
<!-- TODO : Body class -->
<div class="" id="body-class" style="display: none;"></div>
<footer id="footer">
<div class="inner">
<section class="credits">
<span class="credits-theme">Theme <a href="https://github.com/arulrajnet/attila" rel="nofollow">Attila</a></span>
<span class="credits-software">Published with <a href="https://github.com/getpelican/pelican" rel="nofollow">Pelican</a></span>
</section>
</div>
</footer>
</section>
<script src="/theme/js/script.js" type="text/javascript"></script>
</body>
</html>